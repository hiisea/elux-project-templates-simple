import React from 'react';
import {LoadingState, DocumentHead, connectRedux, Switch} from '@elux/react-redux-web';
import {LoadComponent, RouteParams, APPState} from '@/Global';
import NotFound from './NotFound';
import LoginForm from './LoginForm';
import LoadingPanel from '../components/LoadingPanel';
import {SubView} from '../entity';

import '@/assets/css/global.module.<%= css %>';

const Article = LoadComponent('article', 'main');
const My = LoadComponent('my', 'main');

export interface StoreProps {
  subView?: SubView;
  globalLoading?: LoadingState;
  routeParams: RouteParams;
}

function mapStateToProps(appState: APPState): StoreProps {
  const stage = appState.stage;
  const routeParams: RouteParams = appState.route.params;
  return {
    routeParams,
    globalLoading: stage.loading?.global,
    subView: routeParams.stage?.subView,
  };
}

const Component: React.FC<StoreProps> = ({globalLoading, subView, routeParams}) => {
  return (
    <>
      <DocumentHead title="Elux" />
      <Switch elseView={<NotFound />}>
        {subView === 'login' && <LoginForm />}
        {routeParams.article && <Article />}
        {routeParams.my && <My />}
      </Switch>
      <LoadingPanel loadingState={globalLoading} />
    </>
  );
};

export default connectRedux(mapStateToProps)(Component);
